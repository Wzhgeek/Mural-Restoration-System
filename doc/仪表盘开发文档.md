# 克孜尔石窟壁画智慧修复全生命周期管理系统 - 仪表盘开发文档

## 项目概述

本文档描述了克孜尔石窟壁画智慧修复全生命周期管理系统的仪表盘功能开发，采用Vue3 + TDesign + ECharts技术栈实现。

## 技术栈

- **前端框架**: Vue 3.5.18
- **UI组件库**: TDesign Vue Next 1.16.1
- **图表库**: ECharts 5.4.3
- **状态管理**: Pinia 3.0.3
- **路由**: Vue Router 4.5.1
- **构建工具**: Vite 7.1.2

## 功能特性

### 1. 统计卡片区域
- **管理员视图**: 显示总工作流、进行中、已完成、待评估等全局统计
- **修复专家视图**: 显示个人工作流、进行中、已完成、平均评分等个人统计
- **评估专家视图**: 显示待评估、已评估、本月评估、平均给分等评估统计
- **趋势指示器**: 显示数据变化趋势（上升/下降百分比）

### 2. 图表区域
- **工作流趋势图**: 管理员可查看最近7天的工作流创建趋势（折线图）
- **评分分布图**: 管理员和评估专家可查看评分分布情况（饼图）
- **个人进度图**: 修复专家可查看个人月度完成进度（仪表盘图）

### 3. 最近活动
- 显示系统最近的活动记录
- 支持不同操作类型的图标和颜色区分
- 包含操作人、操作类型、目标工作流、时间等信息

### 4. 权限控制
- 基于用户角色（admin、restorer、evaluator）显示不同的数据和功能
- 动态菜单显示
- 数据访问权限控制

## 文件结构

```
webapp/src/
├── views/
│   └── Dashboard.vue          # 仪表盘主组件
├── api/
│   └── dashboard.js          # API服务层
└── package.json              # 项目依赖配置
```

## 核心组件说明

### Dashboard.vue

主要的仪表盘组件，包含以下功能模块：

#### 响应式数据
- `activeMenu`: 当前激活的菜单项
- `currentUser`: 当前用户信息
- `dashboardData`: 仪表盘数据
- `loading`: 加载状态

#### 计算属性
- `statsList`: 根据用户角色动态生成统计卡片数据
- `showTrendChart`: 控制趋势图显示
- `showScoreChart`: 控制评分分布图显示
- `showProgressChart`: 控制个人进度图显示
- `canAccessRestoration`: 修复管理权限
- `canAccessEvaluation`: 评估管理权限
- `canAccessManagement`: 系统管理权限

#### 主要方法
- `loadDashboardData()`: 加载仪表盘数据
- `renderTrendChart()`: 渲染工作流趋势图
- `renderScoreChart()`: 渲染评分分布图
- `renderProgressChart()`: 渲染个人进度图
- `checkAuth()`: 检查用户登录状态
- `handleLogout()`: 处理用户退出登录

### dashboard.js

API服务层，提供与后端的数据交互功能：

#### 主要API方法
- `getDashboardData()`: 获取仪表盘数据
- `getWorkflows()`: 获取工作流列表
- `getEvaluations()`: 获取评估列表
- `getRollbackRequests()`: 获取回溯申请列表
- `getUserInfo()`: 获取用户信息
- `createWorkflow()`: 创建工作流
- `submitForm()`: 提交表单
- `submitEvaluation()`: 提交评估
- `submitRollbackRequest()`: 提交回溯申请
- `approveRollbackRequest()`: 审批回溯申请
- `finalizeWorkflow()`: 设为最终方案

## 样式设计

### TDesign风格适配
- 使用TDesign的CSS变量系统
- 响应式设计，支持移动端适配
- 统一的颜色主题和间距规范
- 卡片式布局，符合现代UI设计趋势

### 关键样式类
- `.dashboard-stat-card`: 统计卡片样式
- `.dashboard-stat-card--main-color`: 主色调卡片样式
- `.dashboard-chart-card`: 图表卡片样式
- `.recent-activities-card`: 最近活动卡片样式
- `.activity-icon-*`: 活动图标颜色样式

## 数据流

1. **初始化**: 组件挂载时检查用户登录状态
2. **数据加载**: 调用API获取仪表盘数据
3. **权限判断**: 根据用户角色显示相应的统计卡片和图表
4. **图表渲染**: 使用ECharts渲染各种图表
5. **实时更新**: 支持数据刷新和图表重绘

## 权限控制

### 用户角色
- **admin**: 管理员，可查看所有数据和功能
- **restorer**: 修复专家，可查看个人相关数据
- **evaluator**: 评估专家，可查看评估相关数据

### 数据访问控制
- 统计卡片根据角色显示不同数据
- 图表根据角色和权限显示
- 菜单项根据权限显示/隐藏

## 响应式设计

### 断点设置
- **桌面端**: >= 768px，完整布局
- **平板端**: 768px - 480px，调整布局
- **移动端**: < 480px，单列布局

### 适配策略
- 统计卡片：桌面端4列，平板端2列，移动端1列
- 图表区域：桌面端多列，移动端单列
- 侧边栏：移动端自动收起

## 开发规范

### 代码规范
- 使用Vue 3 Composition API
- 遵循TDesign设计规范
- 统一的错误处理机制
- 完善的类型注释

### 性能优化
- 图表懒加载
- 数据缓存机制
- 组件按需加载
- 响应式数据优化

## 部署说明

### 环境要求
- Node.js >= 16.0.0
- npm >= 8.0.0

### 安装依赖
```bash
cd webapp
npm install
```

### 开发运行
```bash
npm run dev
```

### 生产构建
```bash
npm run build
```

## 后续扩展

### 功能扩展
- 添加更多图表类型
- 支持数据导出功能
- 增加实时数据推送
- 添加数据筛选和搜索

### 技术优化
- 集成状态管理（Pinia）
- 添加单元测试
- 性能监控和优化
- 国际化支持

## 作者信息

- **作者**: 王梓涵
- **邮箱**: wangzh011031@163.com
- **开发时间**: 2025年
- **项目**: 克孜尔石窟壁画智慧修复全生命周期管理系统

---

*本文档随项目开发持续更新，如有疑问请联系开发团队。*
